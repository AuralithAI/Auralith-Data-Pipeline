# Distributed processing configuration
# ====================================================================
#
# Two modes:
#   1. EXTERNAL — start coordinator + workers separately (across machines).
#      Requires Redis for shared state.
#   2. EMBEDDED — single-machine, in-process coordinator + N workers.
#      Uses "memory" state store (no Redis dependency).
#
# External multi-machine example:
#   Terminal 1: auralith-pipeline coordinator -c configs/distributed.yaml
#   Terminal 2: auralith-pipeline worker -c configs/distributed.yaml \
#                 --coordinator coordinator.internal:8080 --worker-id worker-1
#   Terminal 3: auralith-pipeline submit-job -c configs/distributed.yaml \
#                 -i data/raw/ -o shards/ -t tokenizers/ --external
#
# Embedded single-machine example:
#   auralith-pipeline submit-job -c configs/distributed.yaml \
#       -i data/raw/ -o shards/ -t tokenizers/ --embedded -w 4
# ====================================================================

coordinator:
  host: "0.0.0.0"
  port: 8080

  # State store — "redis" for multi-machine, "memory" for embedded/dev
  state_store_type: redis
  state_store_host: redis.internal
  state_store_port: 6379
  state_store_db: 0
  # state_store_password: null    # Uncomment for cloud Redis (ElastiCache, etc.)

  # Worker monitoring
  heartbeat_interval: 10   # seconds
  heartbeat_timeout: 30    # seconds

  # Task retry settings
  max_retries: 3
  retry_backoff: 5         # seconds
  task_timeout: 3600       # 1 hour

  # Checkpointing
  enable_checkpointing: true
  checkpoint_interval: 300
  checkpoint_dir: ./checkpoints
  keep_last_n_checkpoints: 5

workers:
  - name: processing
    worker_ids:
      - worker-1
      - worker-2
      - worker-3
      - worker-4
    batch_size: 500
    num_processes: 4
    cpu_cores: 4
    memory_gb: 16

job:
  name: distributed-processing
  num_workers: 4
  timeout: 86400   # 24 hours

  # Monitoring
  enable_monitoring: true
  monitoring_port: 9090

  # Output
  output_dir: ./shards
  checkpoint_enabled: true
